# Feature Specification: FinanceHub MVP - Единый интерфейс финансового сервиса

**Feature Branch**: `001-financehub-mvp`  
**Created**: 2025-10-28  
**Status**: Draft  
**Context**: VTB API Hackathon 2025 - Мультибанк: единый интерфейс финансового сервиса

## Проблематика

Сегодня клиенты финансовых услуг вынуждены использовать десятки отдельных приложений и интерфейсов для управления своими финансами. Это приводит к:

- **Фрагментация финансовой картины** — пользователь не видит единой картины своих активов, обязательств и трат
- **Неэффективное принятие финансовых решений** — отсутствие агрегированных данных мешает принимать взвешенные финансовые решения
- **Сложности в управлении личными финансами** — нет единого инструмента для прогнозирования, анализа или персонализированных рекомендаций
- **Ограниченная конкуренция** — новые игроки рынка не могут легко предлагать инновационные продукты из-за высокого порога входа

## Решение

**FinanceHub** — мультибанковское приложение, которое агрегирует финансовые данные из нескольких банков через Open Banking API и предоставляет единый интерфейс для:

1. **Агрегации счетов и карт** из разных банков
2. **Умной аналитики** расходов и доходов с автоматической категоризацией
3. **Автоматического управления бюджетом** с прогнозами и уведомлениями
4. **Персонализированных рекомендаций** по оптимизации финансов
5. **Сравнения банковских продуктов** для выбора лучших предложений

## User Scenarios & Testing

### User Story 1 - Подключение банковских счетов (Priority: P1)

Как пользователь, я хочу подключить свои счета из разных банков через единый безопасный интерфейс, чтобы видеть все мои финансы в одном месте.

**Why this priority**: Это базовая функциональность, без которой продукт не работает. Агрегация данных — ключевая ценность продукта.

**Independent Test**: Можно полностью протестировать, подключив один банк, получив балансы и транзакции. Доставляет ценность: пользователь видит свои счета.

**Acceptance Scenarios**:

1. **Given** пользователь зарегистрирован и авторизован в FinanceHub, **When** он нажимает "Добавить банк" и выбирает VBank, **Then** его перенаправляет на страницу OAuth авторизации VBank
2. **Given** пользователь успешно авторизовался в VBank, **When** он дает согласие на доступ к данным, **Then** система получает токен доступа и загружает список счетов
3. **Given** счета успешно загружены, **When** пользователь открывает дашборд, **Then** он видит балансы всех подключенных счетов с актуальными данными
4. **Given** пользователь подключил один банк, **When** он добавляет второй банк (ABank), **Then** счета из обоих банков отображаются вместе на едином дашборде

---

### User Story 2 - Просмотр агрегированной финансовой картины (Priority: P1)

Как пользователь, я хочу видеть единый дашборд со всеми моими счетами, картами, балансами и последними транзакциями, чтобы понимать свое финансовое состояние с первого взгляда.

**Why this priority**: Основная пользовательская ценность — единая картина финансов. Решает главную проблему фрагментации.

**Independent Test**: После подключения хотя бы одного банка пользователь может открыть дашборд и увидеть агрегированные данные.

**Acceptance Scenarios**:

1. **Given** пользователь подключил несколько банков, **When** он открывает главный дашборд, **Then** он видит общий баланс по всем счетам
2. **Given** пользователь на главном дашборде, **When** он просматривает виджеты, **Then** он видит: общий баланс, расходы за месяц, доходы за месяц, последние 5 транзакций
3. **Given** данные обновлены менее часа назад, **When** пользователь открывает дашборд, **Then** система показывает кэшированные данные без задержки
4. **Given** данные устарели (> 1 часа), **When** пользователь открывает дашборд, **Then** система автоматически обновляет данные из банков

---

### User Story 3 - Просмотр и анализ транзакций (Priority: P2)

Как пользователь, я хочу видеть все свои транзакции из разных банков в одном списке с возможностью фильтрации и поиска, чтобы понимать, куда уходят мои деньги.

**Why this priority**: Важно для анализа расходов, но работает только после базовой агрегации (P1).

**Independent Test**: Можно протестировать, открыв страницу транзакций и применив фильтры. Доставляет ценность: пользователь анализирует свои расходы.

**Acceptance Scenarios**:

1. **Given** пользователь подключил банки с транзакциями, **When** он открывает страницу "Транзакции", **Then** он видит список всех транзакций из всех банков, отсортированных по дате (новые сверху)
2. **Given** пользователь на странице транзакций, **When** он использует фильтр по дате (например, "последние 30 дней"), **Then** отображаются только транзакции за выбранный период
3. **Given** пользователь на странице транзакций, **When** он вводит поисковый запрос (например, "Starbucks"), **Then** отображаются только транзакции, содержащие этот текст в описании
4. **Given** пользователь просматривает транзакцию, **When** он видит ее детали, **Then** отображается: дата, сумма, описание, банк-источник, автоматически определенная категория

---

### User Story 4 - Автоматическая категоризация расходов (Priority: P2)

Как пользователь, я хочу, чтобы система автоматически категоризировала мои расходы (продукты, транспорт, рестораны и т.д.), чтобы понимать структуру своих трат без ручной работы.

**Why this priority**: Критично для аналитики и бюджетирования, но требует базовой агрегации (P1) и загрузки транзакций (P2).

**Independent Test**: Можно протестировать, загрузив транзакции и проверив, что каждой присвоена категория. Доставляет ценность: пользователь видит структуру трат.

**Acceptance Scenarios**:

1. **Given** система загрузила новые транзакции, **When** алгоритм категоризации обрабатывает их, **Then** каждой транзакции присваивается одна из стандартных категорий (Продукты, Транспорт, Рестораны, Развлечения, Здоровье, Одежда, Прочее)
2. **Given** транзакция содержит ключевое слово из словаря категорий (например, "METRO", "Перекресток"), **When** система категоризирует ее, **Then** ей присваивается категория "Продукты"
3. **Given** транзакция не подходит ни под одну категорию, **When** система категоризирует ее, **Then** ей присваивается категория "Прочее"
4. **Given** транзакция категоризирована, **When** пользователь просматривает ее, **Then** категория отображается визуально (иконка + название)

---

### User Story 5 - Аналитика расходов по категориям (Priority: P2)

Как пользователь, я хочу видеть графики и диаграммы моих расходов по категориям за разные периоды, чтобы понимать, на что я трачу больше всего денег.

**Why this priority**: Ключевая аналитическая функция, но требует категоризации (P2). Помогает пользователям принимать финансовые решения.

**Independent Test**: Можно протестировать, открыв страницу аналитики и просмотрев графики. Доставляет ценность: пользователь видит визуализацию своих трат.

**Acceptance Scenarios**:

1. **Given** у пользователя есть категоризированные транзакции за текущий месяц, **When** он открывает страницу "Аналитика", **Then** он видит круговую диаграмму расходов по категориям за текущий месяц
2. **Given** пользователь на странице аналитики, **When** он выбирает период "последние 3 месяца", **Then** отображается линейный график трендов расходов по месяцам
3. **Given** пользователь просматривает круговую диаграмму, **When** он наводит курсор на сегмент категории, **Then** отображается точная сумма и процент от общих расходов
4. **Given** пользователь кликает на категорию в диаграмме, **When** система обрабатывает клик, **Then** открывается список транзакций только этой категории

---

### User Story 6 - Автоматическое создание бюджетов (Priority: P3)

Как пользователь, я хочу, чтобы система автоматически создавала бюджеты для каждой категории на основе моей истории расходов, чтобы контролировать траты без ручной настройки.

**Why this priority**: Инновационная функция, но требует полной аналитики (P1-P2). Добавляет wow-эффект и автоматизацию.

**Independent Test**: Можно протестировать, накопив историю транзакций и проверив, что система создала бюджеты. Доставляет ценность: автоматическое управление финансами.

**Acceptance Scenarios**:

1. **Given** у пользователя есть транзакции за последние 3 месяца, **When** система анализирует историю расходов, **Then** она автоматически создает бюджеты для каждой категории на основе среднего значения трат
2. **Given** система создала бюджет для категории "Продукты" (например, 15,000₽), **When** пользователь открывает страницу "Бюджеты", **Then** он видит бюджет с прогресс-баром (потрачено / лимит)
3. **Given** пользователь потратил 80% бюджета категории, **When** система проверяет прогресс, **Then** отображается предупреждение "Вы потратили 80% бюджета на [категория]"
4. **Given** пользователь превысил бюджет категории, **When** новая транзакция этой категории поступает, **Then** система отправляет уведомление "Превышен бюджет на [категория] на [сумма]"

---

### User Story 7 - Постановка целей накоплений (Priority: P3)

Как пользователь, я хочу ставить финансовые цели (например, "Отпуск - 100,000₽") и отслеживать прогресс их достижения, чтобы мотивировать себя экономить.

**Why this priority**: Дополнительная мотивационная функция, но не критична для MVP. Улучшает пользовательский опыт.

**Independent Test**: Можно протестировать, создав цель и отслеживая прогресс. Доставляет ценность: мотивация к накоплениям.

**Acceptance Scenarios**:

1. **Given** пользователь на странице "Бюджеты", **When** он нажимает "Создать цель" и вводит название ("Отпуск") и сумму (100,000₽), **Then** цель создается и отображается с прогресс-баром (0% выполнено)
2. **Given** пользователь создал цель, **When** он вручную пополняет прогресс (например, +10,000₽), **Then** прогресс обновляется (10% выполнено, 10,000₽ из 100,000₽)
3. **Given** цель на 50% выполнена, **When** пользователь открывает страницу "Бюджеты", **Then** он видит визуальный прогресс и мотивационное сообщение "Вы на полпути к цели!"
4. **Given** цель достигнута (100% выполнено), **When** система проверяет прогресс, **Then** отображается поздравительное сообщение и возможность создать новую цель

---

### User Story 8 - Персонализированные финансовые рекомендации (Priority: P3)

Как пользователь, я хочу получать персонализированные рекомендации по оптимизации финансов (где экономить, какие банковские продукты выгоднее), чтобы улучшать свое финансовое состояние.

**Why this priority**: Инновационная функция с монетизацией через партнерки, но требует полной аналитики и данных о продуктах банков.

**Independent Test**: Можно протестировать, накопив данные и проверив, что система генерирует рекомендации. Доставляет ценность: практические советы.

**Acceptance Scenarios**:

1. **Given** у пользователя есть история расходов за 3+ месяца, **When** система анализирует тренды, **Then** она генерирует инсайты типа "Вы тратите на рестораны на 30% больше, чем в прошлом месяце"
2. **Given** у пользователя есть вклад в одном банке с ставкой 15%, **When** система сравнивает с продуктами других банков, **Then** она предлагает рекомендацию "В SBank вклад под 18% — выгоднее вашего на 3%"
3. **Given** у пользователя есть регулярные траты на подписки (Netflix, Spotify и т.д.), **When** система анализирует их, **Then** она предлагает рекомендацию "Вы можете сэкономить 2,000₽/мес, отменив неиспользуемые подписки"
4. **Given** пользователь кликает на рекомендацию о выгодном продукте, **When** система обрабатывает клик, **Then** открывается детальная информация о продукте с возможностью перехода на сайт банка (партнерская ссылка)

---

### User Story 9 - Сравнение банковских продуктов (Priority: P3)

Как пользователь, я хочу сравнивать банковские продукты (вклады, кредиты, карты) из разных банков в одном интерфейсе, чтобы выбрать наиболее выгодные условия.

**Why this priority**: Дополнительная ценность и источник монетизации, но не критична для базового MVP.

**Independent Test**: Можно протестировать, открыв каталог продуктов и сравнив условия. Доставляет ценность: информированный выбор продуктов.

**Acceptance Scenarios**:

1. **Given** пользователь открыл раздел "Продукты", **When** он выбирает категорию "Вклады", **Then** отображается таблица вкладов из всех подключенных банков с ключевыми параметрами (ставка, срок, минимальная сумма)
2. **Given** пользователь просматривает таблицу продуктов, **When** он кликает на столбец "Ставка" для сортировки, **Then** таблица сортируется по ставке от большей к меньшей
3. **Given** пользователь выбрал интересующий продукт, **When** он нажимает "Подробнее", **Then** открывается детальная страница с полными условиями продукта
4. **Given** пользователь на детальной странице продукта, **When** он нажимает "Оформить", **Then** открывается партнерская ссылка на сайт банка (генерируется lead для монетизации)

---

### Edge Cases

- **Что происходит, когда банковский API недоступен или возвращает ошибку?**
  - Система показывает последние кэшированные данные с отметкой времени последнего обновления
  - Пользователь видит уведомление "Не удалось обновить данные из [банк]. Показаны данные на [время]"
  - Система автоматически повторяет запрос через 5 минут (экспоненциальный backoff)

- **Что происходит, когда срок действия OAuth токена истекает?**
  - Система автоматически пытается обновить токен через refresh token
  - Если обновление не удалось, пользователь видит уведомление "Требуется повторная авторизация в [банк]"
  - Кнопка "Переподключить" запускает новый OAuth flow

- **Что происходит, когда пользователь отзывает согласие на доступ к данным через интерфейс банка?**
  - При следующей попытке обновления данных система получает ошибку авторизации
  - Подключение банка помечается как "Неактивно" с причиной "Доступ отозван"
  - Пользователь видит уведомление с предложением переподключить банк

- **Что происходит, когда у пользователя нет транзакций за выбранный период?**
  - Отображается пустое состояние: "Нет транзакций за этот период"
  - Предлагаются альтернативные действия: выбрать другой период или подключить больше банков

- **Что происходит, когда система не может категоризировать транзакцию?**
  - Транзакции присваивается категория "Прочее"
  - В будущем: пользователь может вручную переназначить категорию (обучение модели)

- **Что происходит при превышении rate limits банковского API?**
  - Система соблюдает лимиты и откладывает запросы
  - Пользователь видит сообщение "Обновление данных занимает больше времени из-за ограничений банка"
  - Используется очередь запросов с приоритетами (критичные данные первыми)

- **Что происходит, когда банковский API возвращает неполные данные?**
  - Система сохраняет то, что получено, и помечает данные как "Частично загружено"
  - Автоматическая повторная попытка через определенное время
  - Пользователь видит что доступно, с пометкой о неполных данных

- **Что происходит, когда пользователь подключает банк без транзакций (новый счет)?**
  - Счет отображается с балансом, но без истории транзакций
  - Показывается сообщение "Нет транзакций для отображения. Новые транзакции появятся автоматически."

## Requirements

### Functional Requirements

#### Аутентификация и безопасность

- **FR-001**: Система MUST поддерживать регистрацию пользователей через email и пароль с подтверждением email
- **FR-002**: Система MUST хэшировать пароли пользователей с использованием современных алгоритмов (bcrypt, Argon2)
- **FR-003**: Система MUST реализовать JWT-токены для аутентификации пользовательских сессий
- **FR-004**: Система MUST поддерживать OAuth 2.0 для интеграции с банковскими API
- **FR-005**: Система MUST хранить банковские токены в зашифрованном виде в базе данных
- **FR-006**: Система MUST автоматически обновлять истекающие токены через refresh token mechanism
- **FR-007**: Система MUST логировать все попытки доступа к чувствительным данным для аудита безопасности

#### Агрегация данных

- **FR-008**: Система MUST поддерживать подключение минимум 3 банков (VBank, ABank, SBank) через их Open Banking API
- **FR-009**: Система MUST запрашивать у пользователя consent (согласие) перед доступом к банковским данным
- **FR-010**: Система MUST получать балансы всех счетов пользователя из подключенных банков
- **FR-011**: Система MUST получать список транзакций за последние 90 дней из подключенных банков
- **FR-012**: Система MUST кэшировать банковские данные для уменьшения количества API запросов
- **FR-013**: Система MUST обновлять кэшированные данные не реже 1 раза в час
- **FR-014**: Система MUST обрабатывать различные форматы дат, сумм и валют от разных банков (нормализация)
- **FR-015**: Система MUST сохранять raw responses от банковских API для отладки и аудита

#### Визуализация данных

- **FR-016**: Система MUST отображать единый дашборд со следующими виджетами: общий баланс, расходы за месяц, доходы за месяц, последние транзакции
- **FR-017**: Система MUST отображать балансы с точностью до копеек (2 знака после запятой)
- **FR-018**: Система MUST группировать счета по банкам с возможностью просмотра деталей каждого счета
- **FR-019**: Система MUST показывать timestamp последнего обновления данных
- **FR-020**: Система MUST поддерживать ручное обновление данных по запросу пользователя (кнопка "Обновить")

#### Транзакции

- **FR-021**: Система MUST отображать список всех транзакций из всех подключенных банков
- **FR-022**: Система MUST сортировать транзакции по дате (от новых к старым) по умолчанию
- **FR-023**: Система MUST поддерживать фильтрацию транзакций по дате (диапазоны: последние 7 дней, 30 дней, 90 дней, custom range)
- **FR-024**: Система MUST поддерживать поиск по транзакциям (по описанию, сумме)
- **FR-025**: Система MUST отображать для каждой транзакции: дату, сумму, описание, категорию, банк-источник
- **FR-026**: Система MUST различать визуально доходные и расходные транзакции (цвет, иконка)

#### Категоризация

- **FR-027**: Система MUST автоматически категоризировать все входящие транзакции
- **FR-028**: Система MUST поддерживать следующие стандартные категории: Продукты, Транспорт, Рестораны, Развлечения, Здоровье, Одежда, Коммунальные услуги, Образование, Прочее
- **FR-029**: Система MUST использовать rule-based алгоритм категоризации (ключевые слова в описании транзакции)
- **FR-030**: Система MUST присваивать категорию "Прочее" транзакциям, не подходящим ни под одну категорию
- **FR-031**: Система MUST хранить словарь ключевых слов для каждой категории (например, "metro", "перекресток" → Продукты)

#### Аналитика

- **FR-032**: Система MUST генерировать круговую диаграмму расходов по категориям за выбранный период
- **FR-033**: Система MUST генерировать линейный график трендов расходов/доходов по месяцам
- **FR-034**: Система MUST отображать топ-5 категорий по расходам за текущий месяц
- **FR-035**: Система MUST вычислять процент каждой категории от общих расходов
- **FR-036**: Система MUST поддерживать выбор периода для аналитики (текущий месяц, последние 3 месяца, последние 6 месяцев)
- **FR-037**: Система MUST позволять кликать на категорию в диаграмме для просмотра детальных транзакций этой категории

#### Бюджетирование (автоматическое)

- **FR-038**: Система MUST автоматически анализировать расходы пользователя за последние 3 месяца
- **FR-039**: Система MUST создавать бюджеты для каждой категории на основе среднего значения трат (±10%)
- **FR-040**: Система MUST отображать прогресс по каждому бюджету (потрачено / лимит) в виде прогресс-бара
- **FR-041**: Система MUST отправлять уведомление, когда пользователь потратил 80% бюджета категории
- **FR-042**: Система MUST отправлять уведомление, когда пользователь превысил бюджет категории
- **FR-043**: Система MUST позволять пользователю вручную редактировать автоматически созданные бюджеты

#### Цели накоплений

- **FR-044**: Система MUST позволять пользователю создавать финансовые цели с названием и целевой суммой
- **FR-045**: Система MUST отображать прогресс достижения цели (текущая сумма / целевая сумма) в процентах
- **FR-046**: Система MUST позволять пользователю вручную пополнять прогресс цели
- **FR-047**: Система MUST отображать мотивационные сообщения при достижении определенных вех (25%, 50%, 75%, 100%)
- **FR-048**: Система MUST позволять удалять или архивировать достигнутые цели

#### Рекомендации

- **FR-049**: Система MUST анализировать тренды расходов и генерировать инсайты (например, "Вы тратите на X на Y% больше")
- **FR-050**: Система MUST загружать каталог банковских продуктов (вклады, кредиты, карты) через Products API
- **FR-051**: Система MUST сравнивать текущие продукты пользователя с продуктами на рынке
- **FR-052**: Система MUST генерировать рекомендации по более выгодным продуктам
- **FR-053**: Система MUST отображать рекомендации на главном дашборде в виде карточек

#### Сравнение продуктов

- **FR-054**: Система MUST отображать каталог банковских продуктов с фильтрацией по типу (вклады, кредиты, карты)
- **FR-055**: Система MUST поддерживать сортировку продуктов по ключевым параметрам (ставка, срок, лимит)
- **FR-056**: Система MUST отображать детальную информацию о продукте (условия, ставка, срок, требования)
- **FR-057**: Система MUST генерировать партнерские ссылки при клике на "Оформить" для монетизации

#### Обработка ошибок

- **FR-058**: Система MUST обрабатывать недоступность банковских API и показывать кэшированные данные
- **FR-059**: Система MUST реализовать retry logic с экспоненциальным backoff для failed API requests
- **FR-060**: Система MUST отображать понятные пользователю сообщения об ошибках (без технических деталей)
- **FR-061**: Система MUST логировать все ошибки интеграции с банками для мониторинга
- **FR-062**: Система MUST соблюдать rate limits банковских API и откладывать запросы при их достижении

### Key Entities

- **User**: Пользователь системы. Атрибуты: email, hashed password, registration date, status (active/blocked). Связи: имеет множество BankConnection, множество Budget, множество Goal.

- **BankConnection**: Подключение к банку. Атрибуты: bank_id (VBank/ABank/SBank), encrypted_access_token, refresh_token, consent_id, status (active/expired/revoked), last_sync_time. Связи: принадлежит User, имеет множество Account.

- **Account**: Банковский счет или карта. Атрибуты: account_id (от банка), account_type (текущий/сберегательный/карта), currency, balance, bank_name. Связи: принадлежит BankConnection, имеет множество Transaction.

- **Transaction**: Финансовая транзакция. Атрибуты: transaction_id (от банка), date, amount, description, category, transaction_type (income/expense), raw_data (JSON от банка). Связи: принадлежит Account.

- **Category**: Категория расходов. Атрибуты: name (Продукты, Транспорт и т.д.), icon, keywords (массив ключевых слов для категоризации). Связи: имеет множество Transaction.

- **Budget**: Бюджет по категории. Атрибуты: category, limit_amount, spent_amount, period (month/year), status (on_track/warning/exceeded), auto_created (boolean). Связи: принадлежит User, связан с Category.

- **Goal**: Цель накопления. Атрибуты: name, target_amount, current_amount, status (active/achieved/archived), created_date. Связи: принадлежит User.

- **BankProduct**: Банковский продукт. Атрибуты: product_id (от банка), bank_name, product_type (deposit/credit/card), name, interest_rate, term, min_amount, description. Связи: может быть в Recommendation.

- **Recommendation**: Персонализированная рекомендация. Атрибуты: type (insight/product/saving_tip), title, description, priority, created_date, status (new/viewed/dismissed). Связи: принадлежит User, может ссылаться на BankProduct.

## Success Criteria

### Measurable Outcomes

#### Пользовательский опыт

- **SC-001**: Пользователь может подключить первый банк и увидеть свои счета менее чем за 3 минуты (включая OAuth)
- **SC-002**: Дашборд загружается менее чем за 2 секунды при наличии кэшированных данных
- **SC-003**: 90% пользователей успешно подключают хотя бы один банк при первом использовании
- **SC-004**: Пользователь видит свои транзакции из всех банков в едином списке без необходимости переключения между интерфейсами

#### Техническая производительность

- **SC-005**: Система корректно обрабатывает 1000 транзакций на пользователя без деградации производительности
- **SC-006**: API запросы к backend выполняются в среднем менее чем за 200ms
- **SC-007**: Система поддерживает 100 одновременных пользователей без снижения отклика
- **SC-008**: Успешность API запросов к банкам составляет не менее 95% (с учетом retry logic)

#### Качество данных

- **SC-009**: 85%+ транзакций категоризируются корректно без ручного вмешательства
- **SC-010**: Данные синхронизируются с банками не реже 1 раза в час
- **SC-011**: Расхождение между балансом в FinanceHub и балансом в банке не превышает 0.01₽ (погрешность округления)

#### Бизнес-метрики

- **SC-012**: 70% пользователей, подключивших банки, возвращаются в приложение на следующий день (retention D1)
- **SC-013**: 50% пользователей используют функцию аналитики хотя бы раз в неделю
- **SC-014**: 10% пользователей кликают на рекомендации банковских продуктов (конверсия в leads для монетизации)
- **SC-015**: Средняя длительность сессии пользователя составляет не менее 5 минут (пользователи изучают свои финансы)

#### Масштабируемость

- **SC-016**: Добавление нового банка в систему требует менее 8 часов разработки (благодаря единому API adapter интерфейсу)
- **SC-017**: Система может обслуживать 10,000 пользователей без изменения архитектуры
- **SC-018**: Стоимость инфраструктуры на одного пользователя не превышает 50₽/месяц

#### Монетизация (для оценки жюри)

- **SC-019**: Модель Freemium: 5% пользователей конвертируются в Premium подписку (299₽/мес)
- **SC-020**: Партнерские комиссии: Генерируется не менее 50 leads на банковские продукты в месяц при базе 10,000 пользователей
- **SC-021**: Прогнозируемый доход Year 1 составляет не менее 3M₽/год (149K из Premium + 100K из партнерок × 12 месяцев)

## Assumptions

1. **Доступность банковских API**: Предполагается, что VBank, ABank и SBank API работают стабильно и доступны 99%+ времени в sandbox окружении.

2. **OAuth flow**: Предполагается, что все банки поддерживают стандартный OAuth 2.0 flow с Authorization Code grant type.

3. **Формат данных**: Предполагается, что все банки возвращают данные в формате, совместимом со стандартом Open Banking Russia v2.1.

4. **Лимиты API**: Предполагается, что rate limits банковских API позволяют обновлять данные для всех пользователей не реже 1 раза в час.

5. **Категоризация**: Предполагается, что rule-based категоризация по ключевым словам даст точность 80%+ для русскоязычных транзакций.

6. **Пользовательская база**: Предполагается целевая аудитория 25-45 лет, активные пользователи банковских услуг, знакомые с digital banking.

7. **Монетизация**: Предполагается, что партнерские программы банков выплачивают комиссию 1-3% CPA за каждый оформленный продукт через наши leads.

8. **Регуляторные требования**: Предполагается, что приложение работает в рамках hackathon sandbox и не требует лицензии ЦБ на данном этапе.

9. **Хранение данных**: Предполагается, что хранение финансовых данных пользователей в собственной БД допустимо для demo/MVP версии.

10. **Язык интерфейса**: Предполагается, что MVP поддерживает только русский язык интерфейса.

## Dependencies

- **External**: Open Banking API от VTB (VBank, ABank, SBank) через sandbox: https://ift.rtuitlab.dev/
- **External**: OAuth 2.0 servers банков для авторизации пользователей
- **External**: Products API для получения каталога банковских продуктов
- **Internal**: База данных для хранения пользователей, транзакций, аналитики
- **Internal**: Cache layer (Redis) для оптимизации API requests к банкам
- **Internal**: Background job scheduler для автоматической синхронизации данных

## Out of Scope (не входит в MVP)

- Инициация платежей (Payment Initiation API) — только чтение данных
- Поддержка криптовалют и криптобирж
- Инвестиционный портфель и управление акциями/облигациями
- Налоговая отчетность и помощь в заполнении деклараций
- Кредитный скоринг и помощь в получении кредитов
- Native мобильные приложения (iOS/Android) — только PWA
- Интеграция с платежными системами (PayPal, WebMoney и т.д.)
- Multi-currency support — только рубли (₽) в MVP
- Семейный доступ и совместные счета
- AI/ML модели для прогнозирования (в MVP — rule-based алгоритмы)

## Business Model

### Freemium модель:

| Tier | Цена | Возможности |
|------|------|-------------|
| **Free** | 0₽ | • Агрегация до 3 счетов<br>• Базовая статистика (текущий месяц)<br>• Категоризация трат |
| **Premium** | 299₽/мес | • Unlimited счета<br>• История за все время<br>• Прогнозы и рекомендации<br>• Автоматические бюджеты<br>• Экспорт в PDF<br>• Приоритетная поддержка |

### Дополнительные источники дохода:

1. **Партнерские комиссии**: При клике на рекомендацию банковского продукта генерируется партнерская ссылка. Банк платит CPA (cost per acquisition) 1-3% за каждого оформившего продукт пользователя.

2. **B2B API**: Предоставление агрегированных (анонимизированных) данных о трендах потребления для малого бизнеса. Цена: от 5,000₽/мес за доступ к API.

### Прогноз Year 1:

- **Целевая аудитория**: 10,000 пользователей
- **Конверсия в Premium**: 5% = 500 пользователей × 299₽ = **149,500₽/мес**
- **Партнерские программы**: ~50 leads/мес × 2,000₽ средняя комиссия = **100,000₽/мес**
- **Итого**: ~250K₽/мес = **3M₽/год**

## Compliance & Security

- **GDPR/PDPA**: Пользователи дают явное согласие на обработку данных. Возможность удалить все данные (right to be forgotten).
- **Банк России стандарты**: Следование рекомендациям ЦБ по безопасности Open API.
- **Data encryption**: Все чувствительные данные (токены, пароли) хранятся в зашифрованном виде.
- **Audit logs**: Логирование всех доступов к финансовым данным для аудита безопасности.
- **Rate limiting**: Защита от DDoS и злоупотреблений API.
- **HTTPS only**: Все коммуникации между frontend и backend только через HTTPS.

## Review & Acceptance Checklist

- [ ] Все mandatory секции заполнены (User Scenarios, Requirements, Success Criteria)
- [ ] User Stories приоритизированы (P1, P2, P3) и независимо тестируемы
- [ ] Functional Requirements специфичны, тестируемы и не содержат технических деталей реализации
- [ ] Success Criteria измеримы и технологически нейтральны
- [ ] Edge Cases покрывают основные сценарии отказа и boundary conditions
- [ ] Business Model четко описана с прогнозом монетизации
- [ ] Out of Scope секция определяет границы MVP
- [ ] Dependencies идентифицированы (внешние API, внутренние сервисы)
- [ ] Compliance & Security требования учтены
- [ ] Спецификация готова к передаче на техническое планирование (`/speckit.plan`)
