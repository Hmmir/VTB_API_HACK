services:
  postgres:
    image: postgres:15-alpine
    container_name: financehub-db
    environment:
      POSTGRES_DB: financehub
      POSTGRES_USER: financehub_user
      POSTGRES_PASSWORD: financehub_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - financehub-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U financehub_user -d financehub"]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: financehub-backend
    ports:
      - "8000:8000"
    environment:
      # Database
      - DATABASE_URL=postgresql://financehub_user:financehub_password@postgres:5432/financehub
      
      # Security
      - SECRET_KEY=your-secret-key-here-change-in-production
      - ENCRYPTION_KEY=your-encryption-key-here-32-chars-long
      
      # VTB API Credentials
      - VTB_API_BASE_URL=https://ift.rtuitlab.dev
      - VTB_TEAM_ID=team075
      - VTB_TEAM_SECRET=1IbEJkXNjswkQLNCqZiYW4mgVSvuC8Di
      
      # GOST Configuration
      - USE_GOST=false
      - GOST_API_URL=https://api.gost.bankingapi.ru:8443
      - BANKING_API_URL=https://api.bankingapi.ru
      - AUTH_API_URL=https://auth.bankingapi.ru/auth/realms/kubernetes/protocol/openid-connect/token
      
      # App Config
      - APP_NAME=FinanceHub
      - APP_VERSION=1.0.0
      - DEBUG=false
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - financehub-network
    volumes:
      - ./backend:/app
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: financehub-frontend
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://localhost:8000/api/v1
    depends_on:
      - backend
    networks:
      - financehub-network
    restart: unless-stopped

volumes:
  postgres_data:

networks:
  financehub-network:
    driver: bridge
